var e=({action:e})=>{e("items.create",(async({key:e,collection:a,payload:n},{database:s})=>{if("city"===a){const a=await async function(e,t){const i=await t("directus_roles").where({name:e}).first();return await t("directus_permissions").where({role:i.id})}("Basel City Admin",s),[r]=await async function(e,i,a){const n=e.translations.create[0].name,s=`City Manager - ${e.translations.create[0].name}`,r=`Manage data for city ${n} (City ID: ${a})`;return await i("directus_roles").insert({id:t(),name:s,description:r,icon:"supervised_user_circle",enforce_tfa:!1,admin_access:!1,app_access:!0}).returning("*")}(n,s,e),o=function(e,t,a){return e.map((e=>{const n={...e,role:t};return delete n.id,n.permissions&&i(n.permissions,a),n.validation&&i(n.validation,a),n}))}(a,r.id,e);console.log(o),await async function(e,t){await t("directus_permissions").insert(e)}(o,s)}})),e("items.delete",(async({collection:e,keys:t},{database:i})=>{if("city"===e)for(const e of t){const t=await i("directus_roles").where("description","like",`%City ID: ${e}%`);for(const e of t)await i("directus_permissions").where({role:e.id}).delete(),await i("directus_roles").where({id:e.id}).delete()}}))};function t(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)}))}function i(e,t){for(const n in e)"object"==typeof e[n]?i(e[n],t):"_eq"!==n||(a=e[n],isNaN(a)||parseInt(Number(a))!=a||isNaN(parseInt(a,10)))||(console.log(e[n]),e[n]=t);var a}export{e as default};
