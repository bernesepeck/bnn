var e=({action:e})=>{e("items.create",(async({key:e,collection:t,payload:s},{database:o})=>{if("city"===t){const t=await a("City Template Admin",o),c=s.translations.create[0].name,d=r(t,(await i(c,o,e)).id,e);await n(d,o)}})),e("items.delete",(async({collection:e,keys:t},{database:i})=>{if("city"===e)for(const e of t){const t=await i("directus_roles").where("description","like",`%City ID: ${e}%`);for(const e of t)await i("directus_permissions").where({role:e.id}).delete(),await i("directus_roles").where({id:e.id}).delete()}})),e("roles.update",(async({collection:e,payload:t,keys:s},{database:o})=>{const c=await o("directus_roles").where({id:s[0]}).first();if(c&&"City Template Admin"===c.name){const e=await a("City Template Admin",o),t=await o("city").select("*");for(const a of t){const t=a.domainname.charAt(0).toUpperCase()+a.domainname.slice(1),s=await i(t,o,a.id),c=r(e,s.id,a.id);await o("directus_permissions").where({role:s.id}).delete(),await n(c,o)}}}))};function t(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)}))}async function i(e,i,a){const s=`City Manager - ${e}`,r=`Manage data for city ${e} (City ID: ${a})`;let n=await i("directus_roles").where("description","like",`%City ID: ${a}%`).first();if(n)return n;return(await i("directus_roles").insert({id:t(),name:s,description:r,icon:"supervised_user_circle",enforce_tfa:!1,admin_access:!1,app_access:!0}).returning("*"))[0]}async function a(e,t){const i=await t("directus_roles").where({name:e}).first();return await t("directus_permissions").where({role:i.id})}function s(e,t){for(const a in e)"object"==typeof e[a]?s(e[a],t):"_eq"!==a||(i=e[a],isNaN(i)||parseInt(Number(i))!=i||isNaN(parseInt(i,10)))||(e[a]=t);var i}function r(e,t,i){return e.map((e=>{const a={...e,role:t};return delete a.id,a.permissions&&s(a.permissions,i),a.validation&&s(a.validation,i),a}))}async function n(e,t){await t("directus_permissions").insert(e)}export{e as default};
